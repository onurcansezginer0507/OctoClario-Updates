result_tb_list_12[[i]]$genotype[j] <- "NTC"
} else if ("Pos Ctrl" %in% well_info$Content[which(well_info$Well %in% rownames(result_tb_list_12[[i]])[j])]){
result_tb_list_12[[i]]$genotype[j] <- "Pos Ctrl"
} else if (result_tb_list_12[[i]]$genotype[j] == "Heterozygous" && names(result_tb_list_12[i]) == "ACE"){
result_tb_list_12[[i]]$genotype[j] <- "INS-DEL"
} else if (result_tb_list_12[[i]]$Tm[j] > tm && names(result_tb_list_12[i]) == "ACE"){
result_tb_list_12[[i]]$genotype[j] <- "DEL-DEL"
} else if (result_tb_list_12[[i]]$Tm[j] < tm && names(result_tb_list_12[i]) == "ACE"){
result_tb_list_12[[i]]$genotype[j] <- "INS-INS"
} else if ( result_tb_list_12[[i]]$genotype[j] == "Heterozygous"){
result_tb_list_12[[i]]$genotype[j] <- "Heterozygous"
} else if (result_tb_list_12[[i]]$Tm[j] > tm && names(result_tb_list_12[i]) != "A1298C"){
result_tb_list_12[[i]]$genotype[j] <- "Wild Type"
} else if (result_tb_list_12[[i]]$Tm[j] < tm && names(result_tb_list_12[i]) != "A1298C"){
result_tb_list_12[[i]]$genotype[j] <- "Homozygous Mutant"
} else if (result_tb_list_12[[i]]$Tm[j] > tm && names(result_tb_list_12[i]) == "A1298C"){
result_tb_list_12[[i]]$genotype[j] <- "Homozygous Mutant"
} else if (result_tb_list_12[[i]]$Tm[j] < tm && names(result_tb_list_12[i]) == "A1298C"){
result_tb_list_12[[i]]$genotype[j] <- "Wild Type"
}
}
}
} else {
result_tb_list_12 <- list()
}
##for apoe
if(ncol(data_list_apoe[[1]]) >1 && ncol(data_list_apoe[[1]]) == ncol(data_list_apoe[[2]])){
result_tb_list_apoe <- list()
result_tb_names_apoe <- c()
for (i in 1:2) {
if (ncol(data_list_apoe[[i]]) < 2) {
result_table_apoe <- data.frame()
next
}
result_table_apoe <- data.frame(row.names = colnames(data_list_apoe[[i]])[2:ncol(data_list_apoe[[i]])], min_dips = c(2:ncol(data_list_apoe[[i]])), max_dips = c(2:ncol(data_list_apoe[[i]])), peak_1 = c(2:ncol(data_list_apoe[[i]])), peak_2 = c(2:ncol(data_list_apoe[[i]])), Tm = c(2:ncol(data_list_apoe[[i]])), patient = c(2:ncol(data_list_apoe[[i]])), genotype = c(2:ncol(data_list_apoe[[i]])))
result_tb_list_apoe <- c(result_tb_list_apoe, list(result_table_apoe))
result_tb_names_apoe <- c(result_tb_names_apoe, names(well_list_apoe[i]))
}
names(result_tb_list_apoe) <- result_tb_names_apoe
well_list_apoe <- well_list_apoe[result_tb_names_apoe]
data_list_apoe <- data_list_apoe[result_tb_names_apoe]
for (i in 1:length(result_tb_list_apoe)) {
for (j in 1:nrow(result_tb_list_apoe[[i]])) {
for (k in 1:nrow(well_list_apoe[[i]])) {
if(rownames(result_tb_list_apoe[[i]])[j] == well_list_apoe[[i]]$Well[k]){
result_tb_list_apoe[[i]]$patient[j] <- well_list_apoe[[i]]$Sample[k]
}
}
}
}
for (i in 1:length(data_list_apoe)) {
all_peak <- c()
min_dips <- c()
max_dips <- c()
true_peak_rfu <- c()
melt_range <- melt_list_cvd[[names(data_list_apoe)[i]]]
lower_bound <- melt_range[1] - 3
upper_bound <- melt_range[2] + 3
for (j in 2:ncol(data_list_apoe[[i]])) {
if (max(data_list_apoe[[i]][,j]) < 100) {
min_dips <- c(min_dips, NA)
max_dips <- c(max_dips, NA)
} else {
min_dips <- c(min_dips, min(data_list_apoe[[i]][which(data_list_apoe[[i]][,j] > max(data_list_apoe[[i]][,j]/2)),1]))
max_dips <- c(max_dips, max(data_list_apoe[[i]][which(data_list_apoe[[i]][,j] > max(data_list_apoe[[i]][,j]/2)),1]))
}
for (k in 1:nrow(data_list_apoe[[i]])) {
if(k > 1 && k < nrow(data_list_apoe[[i]])){
if(data_list_apoe[[i]][k,1] > lower_bound && data_list_apoe[[i]][k,1] < upper_bound){
if (data_list_apoe[[i]][k+1,j] < data_list_apoe[[i]][k,j] && data_list_apoe[[i]][k-1,j] < data_list_apoe[[i]][k,j]) {
all_peak <- c(all_peak, data_list_apoe[[i]][k,j])
}
}
}
}
true_peak_rfu <- sort(all_peak, decreasing = TRUE)
if (length(true_peak_rfu) != 0) {
result_tb_list_apoe[[i]]$peak_1[j-1] <- true_peak_rfu[1]
}
if (length(true_peak_rfu) > 1) {
if (true_peak_rfu[2] > true_peak_rfu[1]/3) {
result_tb_list_apoe[[i]]$peak_2[j-1] <- true_peak_rfu[2]
} else {
result_tb_list_apoe[[i]]$peak_2[j-1] <- NA
}
} else {
result_tb_list_apoe[[i]]$peak_2[j-1] <- NA
}
all_peak <- c()
true_peak_rfu <- c()
}
result_tb_list_apoe[[i]]$min_dips <- min_dips
result_tb_list_apoe[[i]]$max_dips <- max_dips
}
for (i in 1:length(result_tb_list_apoe)) {
tm <- mean(melt_for_apoe[names(result_tb_list_apoe[i])])
for (j in 1:nrow(result_tb_list_apoe[[i]])) {
if ("NTC" %in% well_info$Content[which(well_info$Well %in% rownames(result_tb_list_apoe[[i]])[j])]) {
result_tb_list_apoe[[i]]$genotype[j] <- "NTC"
next
}
if ("Pos Ctrl" %in% well_info$Content[which(well_info$Well %in% rownames(result_tb_list_apoe[[i]])[j])]) {
result_tb_list_apoe[[i]]$genotype[j] <- "Pos Ctrl"
next
}
if (is.na(result_tb_list_apoe[[i]]$min_dips[j]) && is.na(result_tb_list_apoe[[i]]$max_dips[j])) {
result_tb_list_apoe[[i]]$Tm[j] <- NA
next
}
if (is.na(result_tb_list_apoe[[i]]$peak_2[j])) {
result_tb_list_apoe[[i]]$Tm[j] <- data_list_apoe[[names(result_tb_list_apoe[i])]][which(data_list_apoe[[names(result_tb_list_apoe[i])]][,j+1] %in% result_tb_list_apoe[[i]]$peak_1),1]
} else {
result_tb_list_apoe[[i]]$genotype[j] <- "Heterozygous"
}
}
for (j in 1:nrow(result_tb_list_apoe[[i]])) {
if (is.na(result_tb_list_apoe[[i]]$Tm[j])) {
result_tb_list_apoe[[i]]$genotype[j] <- NA
} else if ("NTC" %in% well_info$Content[which(well_info$Well %in% rownames(result_tb_list_apoe[[i]])[j])]){
result_tb_list_apoe[[i]]$genotype[j] <- "NTC"
} else if("Pos Ctrl" %in% well_info$Content[which(well_info$Well %in% rownames(result_tb_list_apoe[[i]])[j])]){
result_tb_list_apoe[[i]]$genotype[j] <- "Pos Ctrl"
} else if ( result_tb_list_apoe[[i]]$genotype[j] == "Heterozygous"){
result_tb_list_apoe[[i]]$genotype[j] <- "Heterozygous"
} else if (result_tb_list_apoe[[i]]$Tm[j] > tm && names(result_tb_list_apoe[i]) != "APOE1"){
result_tb_list_apoe[[i]]$genotype[j] <- "Wild Type"
} else if (result_tb_list_apoe[[i]]$Tm[j] < tm && names(result_tb_list_apoe[i]) != "APOE1"){
result_tb_list_apoe[[i]]$genotype[j] <- "Homozygous Mutant"
} else if (result_tb_list_apoe[[i]]$Tm[j] > tm && names(result_tb_list_apoe[i]) == "APOE1"){
result_tb_list_apoe[[i]]$genotype[j] <- "Homozygous Mutant"
} else if (result_tb_list_apoe[[i]]$Tm[j] < tm && names(result_tb_list_apoe[i]) == "APOE1"){
result_tb_list_apoe[[i]]$genotype[j] <- "Wild Type"
}
}
}
apoe1_table <- result_tb_list_apoe[[1]]
apoe1_table$Parameter <- "APOE1"
apoe1_table <- cbind(Well = rownames(apoe1_table), apoe1_table)
apoe2_table <- result_tb_list_apoe[[2]]
apoe2_table$Parameter <- "APOE2"
apoe2_table <- cbind(Well = rownames(apoe2_table), apoe2_table)
result_tb_list_apoe_final <- result_tb_list_apoe[[1]]
for(i in 1:nrow(result_tb_list_apoe[[1]])){
if (is.na(result_tb_list_apoe[[1]]$genotype[i]) || is.na(result_tb_list_apoe[[2]]$genotype[i])){
result_tb_list_apoe_final$genotype[i] <- "No Peaks Detected within the Boundaries."
}
if(result_tb_list_apoe[[1]]$genotype[i] == "Wild Type" && result_tb_list_apoe[[2]]$genotype[i] == "Homozygous Mutant"){
result_tb_list_apoe_final$genotype[i] <- "E2,E2"
} else if(result_tb_list_apoe[[1]]$genotype[i] == "Wild Type" && result_tb_list_apoe[[2]]$genotype[i] == "Wild Type"){
result_tb_list_apoe_final$genotype[i] <- "E3,E3"
} else if(result_tb_list_apoe[[1]]$genotype[i] == "Homozygous Mutant" && result_tb_list_apoe[[2]]$genotype[i] == "Wild Type"){
result_tb_list_apoe_final$genotype[i] <- "E4,E4"
} else if(result_tb_list_apoe[[1]]$genotype[i] == "Wild Type" && result_tb_list_apoe[[2]]$genotype[i] == "Heterozygous"){
result_tb_list_apoe_final$genotype[i] <- "E2,E3"
} else if(result_tb_list_apoe[[1]]$genotype[i] == "Heterozygous" && result_tb_list_apoe[[2]]$genotype[i] == "Heterozygous"){
result_tb_list_apoe_final$genotype[i] <- "E2,E4"
} else if(result_tb_list_apoe[[1]]$genotype[i] == "Heterozygous" && result_tb_list_apoe[[2]]$genotype[i] == "Wild Type"){
result_tb_list_apoe_final$genotype[i] <- "E3,E4"
} else if(result_tb_list_apoe[[1]]$genotype[i] == "NTC" && result_tb_list_apoe[[2]]$genotype[i] == "NTC"){
result_tb_list_apoe_final$genotype[i] <- "NTC"
} else {
result_tb_list_apoe_final$genotype[i] <- "Pos Ctrl"
}
}
result_tb_list_apoe_final$Parameter <- "APOE"
result_tb_list_apoe_final <- cbind(Well = rownames(result_tb_list_apoe_final), result_tb_list_apoe_final)
result_tb_list_apoe_final <- result_tb_list_apoe_final[,c(1,7,9,8)]
colnames(result_tb_list_apoe_final) <- c("Well", "Sample Name", "Parameter", "Genotype")
apoe_table_final <- list(APOE1 = apoe1_table, APOE2 = apoe2_table, APOE = result_tb_list_apoe_final)
} else if (ncol(data_list_apoe[[1]]) >1 && ncol(data_list_apoe[[1]]) != ncol(data_list_apoe[[2]])){
apoe_table_final <- list(data.frame(), data.frame(), data.frame())
print("APOE genotypes cannot be calculated, please exclude the wells with only one of the APOE parameters were loaded.")
} else {
apoe_table_final <- list(data.frame(), data.frame(), data.frame())
}
result_tb_list_apoe <- list()
result_tb_names_apoe <- c()
for (i in 1:2) {
if (ncol(data_list_apoe[[i]]) < 2) {
result_table_apoe <- data.frame()
next
}
result_table_apoe <- data.frame(row.names = colnames(data_list_apoe[[i]])[2:ncol(data_list_apoe[[i]])], min_dips = c(2:ncol(data_list_apoe[[i]])), max_dips = c(2:ncol(data_list_apoe[[i]])), peak_1 = c(2:ncol(data_list_apoe[[i]])), peak_2 = c(2:ncol(data_list_apoe[[i]])), Tm = c(2:ncol(data_list_apoe[[i]])), patient = c(2:ncol(data_list_apoe[[i]])), genotype = c(2:ncol(data_list_apoe[[i]])))
result_tb_list_apoe <- c(result_tb_list_apoe, list(result_table_apoe))
result_tb_names_apoe <- c(result_tb_names_apoe, names(well_list_apoe[i]))
}
names(result_tb_list_apoe) <- result_tb_names_apoe
well_list_apoe <- well_list_apoe[result_tb_names_apoe]
data_list_apoe <- data_list_apoe[result_tb_names_apoe]
for (i in 1:length(result_tb_list_apoe)) {
for (j in 1:nrow(result_tb_list_apoe[[i]])) {
for (k in 1:nrow(well_list_apoe[[i]])) {
if(rownames(result_tb_list_apoe[[i]])[j] == well_list_apoe[[i]]$Well[k]){
result_tb_list_apoe[[i]]$patient[j] <- well_list_apoe[[i]]$Sample[k]
}
}
}
}
View(result_table_apoe)
View(result_tb_list_apoe)
for (i in 1:length(data_list_apoe)) {
all_peak <- c()
min_dips <- c()
max_dips <- c()
true_peak_rfu <- c()
melt_range <- melt_list_cvd[[names(data_list_apoe)[i]]]
lower_bound <- melt_range[1] - 3
upper_bound <- melt_range[2] + 3
for (j in 2:ncol(data_list_apoe[[i]])) {
if (max(data_list_apoe[[i]][,j]) < 100) {
min_dips <- c(min_dips, NA)
max_dips <- c(max_dips, NA)
} else {
min_dips <- c(min_dips, min(data_list_apoe[[i]][which(data_list_apoe[[i]][,j] > max(data_list_apoe[[i]][,j]/2)),1]))
max_dips <- c(max_dips, max(data_list_apoe[[i]][which(data_list_apoe[[i]][,j] > max(data_list_apoe[[i]][,j]/2)),1]))
}
for (k in 1:nrow(data_list_apoe[[i]])) {
if(k > 1 && k < nrow(data_list_apoe[[i]])){
if(data_list_apoe[[i]][k,1] > lower_bound && data_list_apoe[[i]][k,1] < upper_bound){
if (data_list_apoe[[i]][k+1,j] < data_list_apoe[[i]][k,j] && data_list_apoe[[i]][k-1,j] < data_list_apoe[[i]][k,j]) {
all_peak <- c(all_peak, data_list_apoe[[i]][k,j])
}
}
}
}
true_peak_rfu <- sort(all_peak, decreasing = TRUE)
if (length(true_peak_rfu) != 0) {
result_tb_list_apoe[[i]]$peak_1[j-1] <- true_peak_rfu[1]
}
if (length(true_peak_rfu) > 1) {
if (true_peak_rfu[2] > true_peak_rfu[1]/3) {
result_tb_list_apoe[[i]]$peak_2[j-1] <- true_peak_rfu[2]
} else {
result_tb_list_apoe[[i]]$peak_2[j-1] <- NA
}
} else {
result_tb_list_apoe[[i]]$peak_2[j-1] <- NA
}
all_peak <- c()
true_peak_rfu <- c()
}
result_tb_list_apoe[[i]]$min_dips <- min_dips
result_tb_list_apoe[[i]]$max_dips <- max_dips
}
View(result_tb_list_apoe_final)
result_tb_list_apoe[[1]]
result_tb_list_apoe[[2]]
View(result_tb_list_apoe[["APOE1"]])
for (i in 1:length(result_tb_list_apoe)) {
tm <- mean(melt_for_apoe[names(result_tb_list_apoe[i])])
for (j in 1:nrow(result_tb_list_apoe[[i]])) {
if ("NTC" %in% well_info$Content[which(well_info$Well %in% rownames(result_tb_list_apoe[[i]])[j])]) {
result_tb_list_apoe[[i]]$genotype[j] <- "NTC"
next
}
if ("Pos Ctrl" %in% well_info$Content[which(well_info$Well %in% rownames(result_tb_list_apoe[[i]])[j])]) {
result_tb_list_apoe[[i]]$genotype[j] <- "Pos Ctrl"
next
}
if (is.na(result_tb_list_apoe[[i]]$min_dips[j]) && is.na(result_tb_list_apoe[[i]]$max_dips[j])) {
result_tb_list_apoe[[i]]$Tm[j] <- NA
next
}
if (is.na(result_tb_list_apoe[[i]]$peak_2[j])) {
result_tb_list_apoe[[i]]$Tm[j] <- data_list_apoe[[names(result_tb_list_apoe[i])]][which(data_list_apoe[[names(result_tb_list_apoe[i])]][,j+1] %in% result_tb_list_apoe[[i]]$peak_1),1]
} else {
result_tb_list_apoe[[i]]$genotype[j] <- "Heterozygous"
}
}
for (j in 1:nrow(result_tb_list_apoe[[i]])) {
if (is.na(result_tb_list_apoe[[i]]$Tm[j])) {
result_tb_list_apoe[[i]]$genotype[j] <- NA
} else if ("NTC" %in% well_info$Content[which(well_info$Well %in% rownames(result_tb_list_apoe[[i]])[j])]){
result_tb_list_apoe[[i]]$genotype[j] <- "NTC"
} else if("Pos Ctrl" %in% well_info$Content[which(well_info$Well %in% rownames(result_tb_list_apoe[[i]])[j])]){
result_tb_list_apoe[[i]]$genotype[j] <- "Pos Ctrl"
} else if ( result_tb_list_apoe[[i]]$genotype[j] == "Heterozygous"){
result_tb_list_apoe[[i]]$genotype[j] <- "Heterozygous"
} else if (result_tb_list_apoe[[i]]$Tm[j] > tm && names(result_tb_list_apoe[i]) != "APOE1"){
result_tb_list_apoe[[i]]$genotype[j] <- "Wild Type"
} else if (result_tb_list_apoe[[i]]$Tm[j] < tm && names(result_tb_list_apoe[i]) != "APOE1"){
result_tb_list_apoe[[i]]$genotype[j] <- "Homozygous Mutant"
} else if (result_tb_list_apoe[[i]]$Tm[j] > tm && names(result_tb_list_apoe[i]) == "APOE1"){
result_tb_list_apoe[[i]]$genotype[j] <- "Homozygous Mutant"
} else if (result_tb_list_apoe[[i]]$Tm[j] < tm && names(result_tb_list_apoe[i]) == "APOE1"){
result_tb_list_apoe[[i]]$genotype[j] <- "Wild Type"
}
}
}
apoe1_table <- result_tb_list_apoe[[1]]
apoe1_table$Parameter <- "APOE1"
apoe1_table <- cbind(Well = rownames(apoe1_table), apoe1_table)
apoe2_table <- result_tb_list_apoe[[2]]
apoe2_table$Parameter <- "APOE2"
apoe2_table <- cbind(Well = rownames(apoe2_table), apoe2_table)
result_tb_list_apoe_final <- result_tb_list_apoe[[1]]
View(result_tb_list_apoe_final)
for(i in 1:nrow(result_tb_list_apoe[[1]])){
if (is.na(result_tb_list_apoe[[1]]$genotype[i]) || is.na(result_tb_list_apoe[[2]]$genotype[i])){
result_tb_list_apoe_final$genotype[i] <- "No Peaks Detected within the Boundaries."
}
if(result_tb_list_apoe[[1]]$genotype[i] == "Wild Type" && result_tb_list_apoe[[2]]$genotype[i] == "Homozygous Mutant"){
result_tb_list_apoe_final$genotype[i] <- "E2,E2"
} else if(result_tb_list_apoe[[1]]$genotype[i] == "Wild Type" && result_tb_list_apoe[[2]]$genotype[i] == "Wild Type"){
result_tb_list_apoe_final$genotype[i] <- "E3,E3"
} else if(result_tb_list_apoe[[1]]$genotype[i] == "Homozygous Mutant" && result_tb_list_apoe[[2]]$genotype[i] == "Wild Type"){
result_tb_list_apoe_final$genotype[i] <- "E4,E4"
} else if(result_tb_list_apoe[[1]]$genotype[i] == "Wild Type" && result_tb_list_apoe[[2]]$genotype[i] == "Heterozygous"){
result_tb_list_apoe_final$genotype[i] <- "E2,E3"
} else if(result_tb_list_apoe[[1]]$genotype[i] == "Heterozygous" && result_tb_list_apoe[[2]]$genotype[i] == "Heterozygous"){
result_tb_list_apoe_final$genotype[i] <- "E2,E4"
} else if(result_tb_list_apoe[[1]]$genotype[i] == "Heterozygous" && result_tb_list_apoe[[2]]$genotype[i] == "Wild Type"){
result_tb_list_apoe_final$genotype[i] <- "E3,E4"
} else if(result_tb_list_apoe[[1]]$genotype[i] == "NTC" && result_tb_list_apoe[[2]]$genotype[i] == "NTC"){
result_tb_list_apoe_final$genotype[i] <- "NTC"
} else {
result_tb_list_apoe_final$genotype[i] <- "Pos Ctrl"
}
}
for(i in 1:nrow(result_tb_list_apoe[[1]])){
if (is.na(result_tb_list_apoe[[1]]$genotype[i]) || is.na(result_tb_list_apoe[[2]]$genotype[i])){
result_tb_list_apoe_final$genotype[i] <- "No Peaks Detected within the Boundaries."
next
}
if(result_tb_list_apoe[[1]]$genotype[i] == "Wild Type" && result_tb_list_apoe[[2]]$genotype[i] == "Homozygous Mutant"){
result_tb_list_apoe_final$genotype[i] <- "E2,E2"
} else if(result_tb_list_apoe[[1]]$genotype[i] == "Wild Type" && result_tb_list_apoe[[2]]$genotype[i] == "Wild Type"){
result_tb_list_apoe_final$genotype[i] <- "E3,E3"
} else if(result_tb_list_apoe[[1]]$genotype[i] == "Homozygous Mutant" && result_tb_list_apoe[[2]]$genotype[i] == "Wild Type"){
result_tb_list_apoe_final$genotype[i] <- "E4,E4"
} else if(result_tb_list_apoe[[1]]$genotype[i] == "Wild Type" && result_tb_list_apoe[[2]]$genotype[i] == "Heterozygous"){
result_tb_list_apoe_final$genotype[i] <- "E2,E3"
} else if(result_tb_list_apoe[[1]]$genotype[i] == "Heterozygous" && result_tb_list_apoe[[2]]$genotype[i] == "Heterozygous"){
result_tb_list_apoe_final$genotype[i] <- "E2,E4"
} else if(result_tb_list_apoe[[1]]$genotype[i] == "Heterozygous" && result_tb_list_apoe[[2]]$genotype[i] == "Wild Type"){
result_tb_list_apoe_final$genotype[i] <- "E3,E4"
} else if(result_tb_list_apoe[[1]]$genotype[i] == "NTC" && result_tb_list_apoe[[2]]$genotype[i] == "NTC"){
result_tb_list_apoe_final$genotype[i] <- "NTC"
} else {
result_tb_list_apoe_final$genotype[i] <- "Pos Ctrl"
}
}
result_tb_list_apoe_final$Parameter <- "APOE"
result_tb_list_apoe_final <- cbind(Well = rownames(result_tb_list_apoe_final), result_tb_list_apoe_final)
result_tb_list_apoe_final <- result_tb_list_apoe_final[,c(1,7,9,8)]
colnames(result_tb_list_apoe_final) <- c("Well", "Sample Name", "Parameter", "Genotype")
apoe_table_final <- list(APOE1 = apoe1_table, APOE2 = apoe2_table, APOE = result_tb_list_apoe_final)
##for apoe
if(ncol(data_list_apoe[[1]]) >1 && ncol(data_list_apoe[[1]]) == ncol(data_list_apoe[[2]])){
result_tb_list_apoe <- list()
result_tb_names_apoe <- c()
for (i in 1:2) {
if (ncol(data_list_apoe[[i]]) < 2) {
result_table_apoe <- data.frame()
next
}
result_table_apoe <- data.frame(row.names = colnames(data_list_apoe[[i]])[2:ncol(data_list_apoe[[i]])], min_dips = c(2:ncol(data_list_apoe[[i]])), max_dips = c(2:ncol(data_list_apoe[[i]])), peak_1 = c(2:ncol(data_list_apoe[[i]])), peak_2 = c(2:ncol(data_list_apoe[[i]])), Tm = c(2:ncol(data_list_apoe[[i]])), patient = c(2:ncol(data_list_apoe[[i]])), genotype = c(2:ncol(data_list_apoe[[i]])))
result_tb_list_apoe <- c(result_tb_list_apoe, list(result_table_apoe))
result_tb_names_apoe <- c(result_tb_names_apoe, names(well_list_apoe[i]))
}
names(result_tb_list_apoe) <- result_tb_names_apoe
well_list_apoe <- well_list_apoe[result_tb_names_apoe]
data_list_apoe <- data_list_apoe[result_tb_names_apoe]
for (i in 1:length(result_tb_list_apoe)) {
for (j in 1:nrow(result_tb_list_apoe[[i]])) {
for (k in 1:nrow(well_list_apoe[[i]])) {
if(rownames(result_tb_list_apoe[[i]])[j] == well_list_apoe[[i]]$Well[k]){
result_tb_list_apoe[[i]]$patient[j] <- well_list_apoe[[i]]$Sample[k]
}
}
}
}
for (i in 1:length(data_list_apoe)) {
all_peak <- c()
min_dips <- c()
max_dips <- c()
true_peak_rfu <- c()
melt_range <- melt_list_cvd[[names(data_list_apoe)[i]]]
lower_bound <- melt_range[1] - 3
upper_bound <- melt_range[2] + 3
for (j in 2:ncol(data_list_apoe[[i]])) {
if (max(data_list_apoe[[i]][,j]) < 100) {
min_dips <- c(min_dips, NA)
max_dips <- c(max_dips, NA)
} else {
min_dips <- c(min_dips, min(data_list_apoe[[i]][which(data_list_apoe[[i]][,j] > max(data_list_apoe[[i]][,j]/2)),1]))
max_dips <- c(max_dips, max(data_list_apoe[[i]][which(data_list_apoe[[i]][,j] > max(data_list_apoe[[i]][,j]/2)),1]))
}
for (k in 1:nrow(data_list_apoe[[i]])) {
if(k > 1 && k < nrow(data_list_apoe[[i]])){
if(data_list_apoe[[i]][k,1] > lower_bound && data_list_apoe[[i]][k,1] < upper_bound){
if (data_list_apoe[[i]][k+1,j] < data_list_apoe[[i]][k,j] && data_list_apoe[[i]][k-1,j] < data_list_apoe[[i]][k,j]) {
all_peak <- c(all_peak, data_list_apoe[[i]][k,j])
}
}
}
}
true_peak_rfu <- sort(all_peak, decreasing = TRUE)
if (length(true_peak_rfu) != 0) {
result_tb_list_apoe[[i]]$peak_1[j-1] <- true_peak_rfu[1]
}
if (length(true_peak_rfu) > 1) {
if (true_peak_rfu[2] > true_peak_rfu[1]/3) {
result_tb_list_apoe[[i]]$peak_2[j-1] <- true_peak_rfu[2]
} else {
result_tb_list_apoe[[i]]$peak_2[j-1] <- NA
}
} else {
result_tb_list_apoe[[i]]$peak_2[j-1] <- NA
}
all_peak <- c()
true_peak_rfu <- c()
}
result_tb_list_apoe[[i]]$min_dips <- min_dips
result_tb_list_apoe[[i]]$max_dips <- max_dips
}
for (i in 1:length(result_tb_list_apoe)) {
tm <- mean(melt_for_apoe[names(result_tb_list_apoe[i])])
for (j in 1:nrow(result_tb_list_apoe[[i]])) {
if ("NTC" %in% well_info$Content[which(well_info$Well %in% rownames(result_tb_list_apoe[[i]])[j])]) {
result_tb_list_apoe[[i]]$genotype[j] <- "NTC"
next
}
if ("Pos Ctrl" %in% well_info$Content[which(well_info$Well %in% rownames(result_tb_list_apoe[[i]])[j])]) {
result_tb_list_apoe[[i]]$genotype[j] <- "Pos Ctrl"
next
}
if (is.na(result_tb_list_apoe[[i]]$min_dips[j]) && is.na(result_tb_list_apoe[[i]]$max_dips[j])) {
result_tb_list_apoe[[i]]$Tm[j] <- NA
next
}
if (is.na(result_tb_list_apoe[[i]]$peak_2[j])) {
result_tb_list_apoe[[i]]$Tm[j] <- data_list_apoe[[names(result_tb_list_apoe[i])]][which(data_list_apoe[[names(result_tb_list_apoe[i])]][,j+1] %in% result_tb_list_apoe[[i]]$peak_1),1]
} else {
result_tb_list_apoe[[i]]$genotype[j] <- "Heterozygous"
}
}
for (j in 1:nrow(result_tb_list_apoe[[i]])) {
if (is.na(result_tb_list_apoe[[i]]$Tm[j])) {
result_tb_list_apoe[[i]]$genotype[j] <- NA
} else if ("NTC" %in% well_info$Content[which(well_info$Well %in% rownames(result_tb_list_apoe[[i]])[j])]){
result_tb_list_apoe[[i]]$genotype[j] <- "NTC"
} else if("Pos Ctrl" %in% well_info$Content[which(well_info$Well %in% rownames(result_tb_list_apoe[[i]])[j])]){
result_tb_list_apoe[[i]]$genotype[j] <- "Pos Ctrl"
} else if ( result_tb_list_apoe[[i]]$genotype[j] == "Heterozygous"){
result_tb_list_apoe[[i]]$genotype[j] <- "Heterozygous"
} else if (result_tb_list_apoe[[i]]$Tm[j] > tm && names(result_tb_list_apoe[i]) != "APOE1"){
result_tb_list_apoe[[i]]$genotype[j] <- "Wild Type"
} else if (result_tb_list_apoe[[i]]$Tm[j] < tm && names(result_tb_list_apoe[i]) != "APOE1"){
result_tb_list_apoe[[i]]$genotype[j] <- "Homozygous Mutant"
} else if (result_tb_list_apoe[[i]]$Tm[j] > tm && names(result_tb_list_apoe[i]) == "APOE1"){
result_tb_list_apoe[[i]]$genotype[j] <- "Homozygous Mutant"
} else if (result_tb_list_apoe[[i]]$Tm[j] < tm && names(result_tb_list_apoe[i]) == "APOE1"){
result_tb_list_apoe[[i]]$genotype[j] <- "Wild Type"
}
}
}
apoe1_table <- result_tb_list_apoe[[1]]
apoe1_table$Parameter <- "APOE1"
apoe1_table <- cbind(Well = rownames(apoe1_table), apoe1_table)
apoe2_table <- result_tb_list_apoe[[2]]
apoe2_table$Parameter <- "APOE2"
apoe2_table <- cbind(Well = rownames(apoe2_table), apoe2_table)
result_tb_list_apoe_final <- result_tb_list_apoe[[1]]
for(i in 1:nrow(result_tb_list_apoe[[1]])){
if (is.na(result_tb_list_apoe[[1]]$genotype[i]) || is.na(result_tb_list_apoe[[2]]$genotype[i])){
result_tb_list_apoe_final$genotype[i] <- "No Peaks Detected within the Boundaries."
next
}
if(result_tb_list_apoe[[1]]$genotype[i] == "Wild Type" && result_tb_list_apoe[[2]]$genotype[i] == "Homozygous Mutant"){
result_tb_list_apoe_final$genotype[i] <- "E2,E2"
} else if(result_tb_list_apoe[[1]]$genotype[i] == "Wild Type" && result_tb_list_apoe[[2]]$genotype[i] == "Wild Type"){
result_tb_list_apoe_final$genotype[i] <- "E3,E3"
} else if(result_tb_list_apoe[[1]]$genotype[i] == "Homozygous Mutant" && result_tb_list_apoe[[2]]$genotype[i] == "Wild Type"){
result_tb_list_apoe_final$genotype[i] <- "E4,E4"
} else if(result_tb_list_apoe[[1]]$genotype[i] == "Wild Type" && result_tb_list_apoe[[2]]$genotype[i] == "Heterozygous"){
result_tb_list_apoe_final$genotype[i] <- "E2,E3"
} else if(result_tb_list_apoe[[1]]$genotype[i] == "Heterozygous" && result_tb_list_apoe[[2]]$genotype[i] == "Heterozygous"){
result_tb_list_apoe_final$genotype[i] <- "E2,E4"
} else if(result_tb_list_apoe[[1]]$genotype[i] == "Heterozygous" && result_tb_list_apoe[[2]]$genotype[i] == "Wild Type"){
result_tb_list_apoe_final$genotype[i] <- "E3,E4"
} else if(result_tb_list_apoe[[1]]$genotype[i] == "NTC" && result_tb_list_apoe[[2]]$genotype[i] == "NTC"){
result_tb_list_apoe_final$genotype[i] <- "NTC"
} else {
result_tb_list_apoe_final$genotype[i] <- "Pos Ctrl"
}
}
result_tb_list_apoe_final$Parameter <- "APOE"
result_tb_list_apoe_final <- cbind(Well = rownames(result_tb_list_apoe_final), result_tb_list_apoe_final)
result_tb_list_apoe_final <- result_tb_list_apoe_final[,c(1,7,9,8)]
colnames(result_tb_list_apoe_final) <- c("Well", "Sample Name", "Parameter", "Genotype")
apoe_table_final <- list(APOE1 = apoe1_table, APOE2 = apoe2_table, APOE = result_tb_list_apoe_final)
} else if (ncol(data_list_apoe[[1]]) >1 && ncol(data_list_apoe[[1]]) != ncol(data_list_apoe[[2]])){
apoe_table_final <- list(data.frame(), data.frame(), data.frame())
print("APOE genotypes cannot be calculated, please exclude the wells with only one of the APOE parameters were loaded.")
} else {
apoe_table_final <- list(data.frame(), data.frame(), data.frame())
}
if(length(result_tb_list_12) > 0){
for (i in 1:length(result_tb_list_12)) {
result_tb_list_12[[i]]$Parameter <- c(rep(names(result_tb_list_12[i]), nrow(result_tb_list_12[[i]])))
result_tb_list_12[[i]] <- cbind(rownames(result_tb_list_12[[i]]), result_tb_list_12[[i]])
result_tb_list_12[[i]] <- result_tb_list_12[[i]][,c(1,7,9,8,4,5)]
colnames(result_tb_list_12[[i]]) <- c("Well", "Sample Name", "Parameter", "Genotype", "peak_1", "peak_2")
}
}
result_tb_cvd <- c(result_tb_list_12, list(result_tb_pai), apoe_table_final)
names(result_tb_cvd) <- c(names(result_tb_list_12), "PAI", "APOE1", "APOE2", "APOE")
result_tb_cvd <- result_tb_cvd[sapply(result_tb_cvd, function(x) dim(x)[1]) > 0]
return(list(result_tb_cvd,
data_list_graph))
View(result_tb_cvd)
